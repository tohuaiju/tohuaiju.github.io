<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Hierarchy Visualization</title>
    <style>
        .node {
            fill: #ccc;
            stroke: #fff;
            stroke-width: 2px;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }

        text {
            font: 10px sans-serif;
            pointer-events: none;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <svg width="100%" height="100%"></svg>

    <script>
        var data = `植物界 被子植物门 双子叶植物纲 毛莨目 毛茛科
                    植物界 被子植物门 单子叶植物纲 芭蕉目 竹芋科 竹芋属
                    植物界 被子植物门 双子叶植物纲 捩花目 萝藦科 豹皮花属
                    植物界 被子植物门 双子叶植物纲 侧膜胎座目 秋海棠科 秋海棠属
                    植物界 被子植物门 双子叶植物纲 捩花目 萝藦科 牛角瓜属
                    植物界 被子植物门 双子叶植物纲 唇形目 爵床科 金苞花属
                    植物界 被子植物门 双子叶植物纲 中央种子目 马齿苋科 马齿苋科
                    植物界 被子植物门 双子叶植物纲 玄参目 紫葳科 葫芦树属
                    植物界 被子植物门 双子叶植物纲 桔梗目 菊科 蟛蜞菊属
                    植物界 被子植物门 单子叶植物纲 兰目 兰科 莲瓣兰属
                    植物界 被子植物门 单子叶植物纲 泽泻目 天南星科 喜林芋属
                    植物界 被子植物门 百合纲 姜目 竹芋科 肖竹芋属
                    植物界 被子植物门 双子叶植物纲 百合目 石蒜科 葱莲属
                    植物界    景天科 景天科伽蓝菜属
                    植物界 被子植物门 单子叶植物纲 百合目 龙舌兰科 虎尾兰属`.split('\n').map(d => d.trim().split(/\s+/));

        var links = [];
        var nodesMap = {};
        var nodes = [];

        data.forEach(function(d) {
            for (var i = 0; i < d.length - 1; i++) {
                var parentName = d[i];
                var childName = d[i + 1];

                if (!nodesMap[parentName]) {
                    var parentNode = { name: parentName, children: [] };
                    nodes.push(parentNode);
                    nodesMap[parentName] = parentNode;
                }

                if (!nodesMap[childName]) {
                    var childNode = { name: childName };
                    nodes.push(childNode);
                    nodesMap[childName] = childNode;
                }

                nodesMap[parentName].children.push(nodesMap[childName]);
                links.push({ source: nodesMap[parentName], target: nodesMap[childName] });
            }
        });

        var width = window.innerWidth;
        var height = window.innerHeight;

        var svg = d3.select("svg")
            .attr("width", width)
            .attr("height", height);

        var simulation = d3.forceSimulation(nodes)
            .force("charge", d3.forceManyBody().strength(-100))
            .force("link", d3.forceLink(links).distance(50).strength(1))
            .force("center", d3.forceCenter(width / 2, height / 2));

        var link = svg.selectAll(".link")
            .data(links)
            .enter().append("line")
            .attr("class", "link");

        var node = svg.selectAll(".node")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 5)
            .on("click", click)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        var label = svg.selectAll(".label")
            .data(nodes)
            .enter().append("text")
            .attr("class", "label")
            .text(function(d) { return d.name; });

        simulation.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });

            node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });

            label.attr("x", function(d) { return d.x + 10; })
                .attr("y", function(d) { return d.y; });
        });

        function click(event, d) {
            if (!d3.event.defaultPrevented) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                simulation.nodes(nodes);
                simulation.alpha(1).restart();
            }
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
